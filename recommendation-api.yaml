openapi: 3.0.3
info:
  description: API zum Abruf passender empfohlener Finanzierungsvorschläge.
  version: 0.0.1
  title: Empfohlene Finanzierungsvorschläge API
paths:
  /angebote:
    post:
      summary: 'Empfohlene Finanzierungsvorschläge ermitteln (derzeit genau einen)'
      operationId: 'getOffers'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ErfassteDaten'
      responses:
        '200':
          $ref: '#/components/schemas/FinanzierungsVorschlag'
        '400':
          description: 'Bad request'
        '404':
          description: 'Not found (wird zurückgegeben, wenn der Input valide ist, aber dennoch keine Angebote ermittelt werden konnten)'
        '405':
          description: 'Invalid input'
        '500':
          description: 'Internal server error'
components:
  schemas:
    ErfassteDaten:
      type: object
      properties:
        haushalt:
          type: array
          items:
            $ref: '#/components/schemas/Haushalt'
        finanzierungsObjekt:
          $ref: '#/components/schemas/FinanzierungsObjekt'
        praeferenzen:
          $ref: '#/components/schemas/Praeferenzen'
      required:
        - haushalt
        - finanzierungsObjekt
    Antragsteller:
      type: object
      properties:
        selbststaendig:
          type: boolean
        beschaeftigtSeit:
          type: string
          format: date
        arbeitBefristet:
          type: boolean
          description: 'true, wenn Beschäftigungsverhältnis befristet ist, ansonsten false'
        nettoEinkommen:
          type: number
          description: 'in Euro'
        geburtsDatum:
          type: string
          format: date
        beschaeftigungsArt:
          enum:
            - ANGESTELLTER
            - ARBEITER
            - BEAMTER
            - FREIBERUFLER
            - SELBSTSTAENDIGER
            - RENTER
            - HAUSMANN
            - ARBEITSLOSER
      required:
        - nettoEinkommen
    Haushalt:
      type: object
      properties:
        antragsteller:
          type: array
          items:
            $ref: '#/components/schemas/Antragsteller'
        bankSparGuthaben:
          type: number
          example: 14500
        sonstigeEinnahmen:
          type: number
          example: 380
        nichtAbgeloestePrivateDarlehenRestschuld:
          type: number
          example: 42000
        nichtAbgeloesteRatenkrediteRestschuld:
          type: number
          example: 8500
    FinanzierungsObjekt:
      type: object
      properties:
        objektArt:
          enum:
            - DOPPELHAUSHAELFTE
            - EINFAMILIENHAUS
            - MEHRFAMILIENHAUS
            - REIHENHAUS
            - ZWEIFAMILIENHAUS
        vermietet:
          type: boolean
          description: 'true, wenn das Objekt vermietet ist, ansonsten false'
        bauJahr:
          type: integer
        gewerbeEinheit:
          type: boolean
          description: 'true, wenn das Objekt überwiegend oder ausschließlich gewerblich genutzt wird, ansonsten false'
        postleitzahl:
          type: string
        wohnFlaeche:
          type: number
          description: 'in Quadratmetern'
          example: 120.50
        grundstueckKaufpreis:
          type: number
          description: 'in Euro'
          example: 380000
        preis:
          type: number
          description: 'Kaufpreis / Herstellungskosten / ...'
          example: 250000
        herstellungskostenInklusiveEigenleistung:
          type: number
          description: 'Herstellungskosten, die nicht im "preis" enthalten sind'
        modernisierungsKostenInklusiveEigenleistungen:
          type: number
          description: 'Kosten zusätzlicher Modernisierungsmaßnahmen, die nicht in "preis" enthalten sind'
          example: 10000
    Praeferenzen:
      type: object
      properties:
        wunschRate:
          type: number
        einzugsDatum:
          type: string
          format: date
        entscheidungsBisDatum:
          type: string
          format: date
        laufzeit:
          enum:
            - SCHNELLST_MOEGLICH
            - BIS_ZUR_RENTE
            - EGAL
    FinanzierungsVorschlag:
      type: object
      properties:
        annahmeFrist:
          type: string
          format: date-time
        bausparAngebote:
          type: array
          items:
            $ref: '#/components/schemas/BausparAngebot'
        darlehen:
          type: array
          items:
            $ref: '#/components/schemas/Darlehen'
        darlehensSumme:
          type: number
        sollZins:
          type: number
        effektivZins:
          type: number
        kennung:
          type: string
    BausparAngebot:
      type: object
    Darlehen:
      type: object
      properties:
        auszahlungsBetrag:
          type: number
          description: 'Auszahlungsbetrag is the net darlehensBetrag in euro'
        auszahlungsDatum:
          type: string
          format: date
        darlehensBetrag:
          type: number
        sollZins:
          type: number
          description: 'in Prozent, hundert-basiert'
          example: 2.34
        effektivZins:
          type: number
          description: 'in Prozent, hundert-basiert'
          example: 2.56
        produktAnbieter:
          type: string
        finanzierenderProduktAnbieter:
          type: string
          description: 'über die Finanzierung entscheidender ProduktAnbieter (kann von "produktAnbieter" abweichen - z.B. bei KfW-Darlehen)'
        gesamtKosten:
          type: number
          description: 'in Euro'
          example: 450000
        gesamtLaufzeit:
          type: integer
          format: int32
          description: '(kalkulatorische) Laufzeit der Finanzierung'
        rate:
          type: number
          description: 'monatliche Gesamt-Rate in Euro (inklusive "tilgung")'
        tilgung:
          type: number
          description: 'monatliche Tilgungs-Rate in Euro'
        typ:
          type: string
          enum:
            - ANNUITAETEN_DARLEHEN
            - FORWARD_DARLEHEN
            - REGIONAL_FOERDER_DARLEHEN
            - KFW_DARLEHEN
            - PRIVAT_DARLEHEN
            - ZWISCHEN_FINANZIERUNG
            - VARIABLES_DARLEHEN
            - BAUSPARVERTRAG
        zinsBindung:
          type: integer
          description: 'in Jahren'
        zinsZahlungsBeginnAm:
          type: string
          format: date
      title: Darlehen


#
#  Folgende Werte sind bisher nur über Präferenzen erfasst worden und müssen zukünftig als zentrale Parameter eines Finanzierungswunsches berücksichtigt werden
#
#  Laufzeit (als Stichtag falls gewünscht)
#
#  Wunschrate
#
#  Einzugsdatum/Fertigstellung
#
#  Entscheidung bis Datum
#
#  Für eine valide Market Engine-Anfrgae werden dann noch folgende Werte benötigt, die aus den Eingabedaten berechnet werden können
#
#Darlehensbetrag: Kaufpreis+Nebenkosten-Eigenkapital
#
#BZ-Zeit: Einzugsdatum - Entscheidungsdatum
#
#Tilgung:  Tigungsplan-Rechner
#
#Förderfähig: Neubau, eigengenutzt, kein Gewerbe - KfW55,
#
#Nebenkosten: Bundesland (Makler/Grunderwerb/Notar)
#
#  Lage (RedShift-Geodaten-Service, urban, Küste)
#
#  SoTi (eigentlich immer JA)

# Fragen:
# - Präferenzen mit Jens klären
# - welche Felder sind must have - welche nice to have?
# - brauchen wir für v0.1 Meldungen?
# - BausparAngebot definieren?
# - brauchen wir am Input selbstständig + Beschäftigungsverhältnis?
# - wie englische Doku?
# - finanzierenderProduktAnbieter: warum am Darlehen statt am Angebot?
# - gewerbeEinheit korrekt beschrieben?
